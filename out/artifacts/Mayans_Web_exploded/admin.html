<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Admin Panel</title>
    <style>
        * {margin:0;padding:0;box-sizing:border-box;}
        body {font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);padding:20px;min-height:100vh;}
        .container {max-width:1400px;margin:0 auto;background:white;border-radius:15px;box-shadow:0 20px 60px rgba(0,0,0,0.3);overflow:hidden;}
        .header {background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:30px;text-align:center;}
        .header h1 {font-size:2.5em;margin-bottom:10px;}
        .content {display:grid;grid-template-columns:1fr 2fr;gap:0;min-height:600px;}
        .form-section {background:#f8f9fa;padding:30px;border-right:2px solid #e0e0e0;overflow-y:auto;max-height:800px;}
        .form-section h2 {color:#667eea;margin-bottom:25px;font-size:1.8em;}
        .form-group {margin-bottom:20px;}
        .form-group label {display:block;margin-bottom:8px;color:#333;font-weight:600;font-size:0.95em;}
        .form-group input,.form-group select,.form-group textarea {width:100%;padding:12px;border:2px solid #e0e0e0;border-radius:8px;font-size:1em;transition:all 0.3s;}
        .form-group input:focus,.form-group select:focus,.form-group textarea:focus {outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,0.1);}
        .form-group textarea {resize:vertical;min-height:80px;}
        .checkbox-group {display:flex;align-items:center;gap:10px;}
        .checkbox-group input[type="checkbox"] {width:20px;height:20px;cursor:pointer;}
        .form-actions {display:flex;gap:10px;margin-top:25px;}
        .btn {flex:1;padding:14px 24px;border:none;border-radius:8px;font-size:1em;font-weight:600;cursor:pointer;transition:all 0.3s;text-transform:uppercase;letter-spacing:0.5px;}
        .btn-primary {background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;}
        .btn-primary:hover {transform:translateY(-2px);box-shadow:0 5px 15px rgba(102,126,234,0.4);}
        .btn-secondary {background:#6c757d;color:white;}
        .btn-secondary:hover {background:#5a6268;}
        .table-section {padding:30px;overflow-x:auto;}
        .table-section h2 {color:#667eea;margin-bottom:20px;font-size:1.8em;}
        .search-box {margin-bottom:20px;position:relative;}
        .search-box input {width:100%;padding:12px 40px 12px 15px;border:2px solid #e0e0e0;border-radius:8px;font-size:1em;}
        .search-box::after {content:"üîç";position:absolute;right:15px;top:50%;transform:translateY(-50%);}
        table {width:100%;border-collapse:collapse;background:white;border-radius:8px;overflow:hidden;box-shadow:0 2px 10px rgba(0,0,0,0.1);}
        thead {background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;}
        th {padding:15px;text-align:left;font-weight:600;font-size:0.9em;text-transform:uppercase;letter-spacing:0.5px;}
        td {padding:15px;border-bottom:1px solid #f0f0f0;}
        tbody tr {transition:background 0.3s;}
        tbody tr:hover {background:#f8f9fa;}
        .action-btns {display:flex;gap:8px;}
        .btn-edit, .btn-delete {padding:8px 16px;border:none;border-radius:5px;cursor:pointer;font-size:0.9em;font-weight:600;transition:all 0.3s;}
        .btn-edit {background:#28a745;color:white;}
        .btn-edit:hover {background:#218838;transform:scale(1.05);}
        .btn-delete {background:#dc3545;color:white;}
        .btn-delete:hover {background:#c82333;transform:scale(1.05);}
        .image-preview {width:50px;height:50px;object-fit:cover;border-radius:5px;}
        .required {color:#dc3545;}
        @media (max-width:1024px){.content{grid-template-columns:1fr;}.form-section{border-right:none;border-bottom:2px solid #e0e0e0;}}
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üì± Product Management System</h1>
        <p>Add, Update & Delete Products</p>
    </div>

    <div class="content">
        <!-- Form Section -->
        <div class="form-section">
            <h2 id="formTitle">‚ûï Add New Product</h2>
            <form id="productForm" enctype="multipart/form-data">
                <input type="hidden" id="productId">
                <div class="form-group">
                    <label>Title <span class="required">*</span></label>
                    <input type="text" id="title" required>
                </div>
                <div class="form-group">
                    <label>Brand <span class="required">*</span></label>
                    <select id="brandId" required>
                        <option value="">Select Brand</option>
                        <option value="1">Apple</option>
                        <option value="2">Samsung</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Model <span class="required">*</span></label>
                    <select id="model" required>
                        <option value="">Select Model</option>
                        <option value="1">iPhone 15 Pro</option>
                        <option value="2">Samsung Galaxy S24</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Description <span class="required">*</span></label>
                    <textarea id="description" required></textarea>
                </div>
                <div class="form-group">
                    <label>Price ($)</label>
                    <input type="number" id="price" step="0.01" min="0">
                </div>
                <div class="form-group">
                    <label>Quantity <span class="required">*</span></label>
                    <input type="number" id="qty" min="0" required>
                </div>
                <div class="form-group">
                    <label>Color</label>
                    <select id="color">
                        <option value="">Select Color</option>
                        <option value="1">Black</option>
                        <option value="2">White</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Storage</label>
                    <select id="storage">
                        <option value="">Select Storage</option>
                        <option value="1">64GB</option>
                        <option value="2">128GB</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Quality</label>
                    <select id="quality">
                        <option value="">Select Quality</option>
                        <option value="1">Brand New</option>
                        <option value="2">Like New</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Image 1 <span class="required">*</span></label>
                    <input type="file" id="image1" accept="image/*" required>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Save Product</button>
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">Clear Form</button>
                </div>
            </form>
        </div>

        <!-- Table Section -->
        <div class="table-section">
            <h2>üìã Product List</h2>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search products..." onkeyup="searchProducts()">
            </div>
            <table id="productTable">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Image</th>
                    <th>Title</th>
                    <th>Model</th>
                    <th>Price</th>
                    <th>Qty</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody id="productTableBody">
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    document.getElementById('productForm').addEventListener('submit', function(e){
        e.preventDefault();

        const formData = new FormData();
        formData.append("title", document.getElementById('title').value);
        formData.append("brandId", document.getElementById('brandId').value);
        formData.append("modelId", document.getElementById('model').value);
        formData.append("description", document.getElementById('description').value);
        formData.append("storageId", document.getElementById('storage').value);
        formData.append("colorId", document.getElementById('color').value);
        formData.append("conditionId", document.getElementById('quality').value);
        formData.append("price", document.getElementById('price').value);
        formData.append("qty", document.getElementById('qty').value);
        formData.append("image1", document.getElementById('image1').files[0]);
        formData.append("image2", document.getElementById('image2').files[0]);
        formData.append("image3", document.getElementById('image3').files[0]);

        fetch('SaveProduct', {method:'POST', body:formData})
            .then(res=>res.json())
            .then(data=>{
                if(data.status){
                    alert("‚úÖ Product saved successfully!");
                    // Use server image URL returned in JSON
                    addProductToTable({
                        id: data.productId,
                        title: document.getElementById('title').value,
                        modelName: document.getElementById('model').selectedOptions[0].text,
                        price: document.getElementById('price').value,
                        qty: document.getElementById('qty').value,
                        imageUrl: data.imageUrl // Must return from backend!
                    });
                    resetForm();
                } else {
                    alert("‚ö†Ô∏è Error: "+data.message);
                }
            })
            .catch(err=>alert("‚ö†Ô∏è Server error: "+err));
    });

    function resetForm(){
        document.getElementById('productForm').reset();
    }

    function addProductToTable(product){
        const tbody = document.getElementById('productTableBody');
        const row = document.createElement('tr');
        row.innerHTML = `
        <td>${product.id}</td>
        <td><img src="${product.imageUrl}" class="image-preview"></td>
        <td>${product.title}</td>
        <td>${product.modelName}</td>
        <td>${product.price}</td>
        <td>${product.qty}</td>
        <td class="action-btns">
            <button class="btn-edit" onclick="editProduct(${product.id})">Edit</button>
            <button class="btn-delete" onclick="deleteProduct(${product.id})">Delete</button>
        </td>
    `;
        tbody.appendChild(row);
    }

    function editProduct(id){alert("Edit product ID: "+id);}
    function deleteProduct(id){alert("Delete product ID: "+id);}

    function searchProducts(){
        const input = document.getElementById('searchInput').value.toLowerCase();
        const rows = document.getElementById('productTableBody').getElementsByTagName('tr');
        Array.from(rows).forEach(row=>{
            const title = row.cells[2].innerText.toLowerCase();
            const model = row.cells[3].innerText.toLowerCase();
            row.style.display = (title.includes(input) || model.includes(input)) ? '' : 'none';
        });
    }
</script>
</body>
</html>
