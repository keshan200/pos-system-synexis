<!--
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin | Add Product</title>


    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background: #f4f6f9;
        }

        .admin-layout {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 220px;
            background: #1e1e2f;
            color: white;
            padding: 20px;
        }

        .sidebar h2 {
            text-align: center;
            margin-bottom: 30px;
        }

        .sidebar ul {
            list-style: none;
        }

        .sidebar li {
            padding: 12px;
            cursor: pointer;
            border-radius: 6px;
        }

        .sidebar li:hover,
        .sidebar .active {
            background: #3a3af0;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 30px;
        }

        .main-content h1 {
            margin-bottom: 20px;
        }

        /* Form */
        .product-form {
            background: white;
            padding: 25px;
            border-radius: 8px;
            max-width: 900px;
        }

        .product-form input,
        .product-form select,
        .product-form textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        .product-form textarea {
            resize: none;
            height: 90px;
        }

        .row {
            display: flex;
            gap: 15px;
        }

        .product-form button {
            background: #3a3af0;
            color: white;
            padding: 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            width: 200px;
        }

        .product-form button:hover {
            background: #2c2cd8;
        }

    </style>
</head>
<body>

<div class="admin-layout">

    &lt;!&ndash; Sidebar &ndash;&gt;
    <aside class="sidebar">
        <h2>ADMIN</h2>
        <ul>
            <li class="active">Add Product</li>
            <li>Add Records</li>
            <li>Users</li>
            <li>Orders</li>
        </ul>
    </aside>

    &lt;!&ndash; Main &ndash;&gt;
    <main class="main-content">
        <h1>Add New Product</h1>

        <form id="productForm" class="product-form" enctype="multipart/form-data">

            <div class="row">


                <select id="model" name="modelId">
                    <option value="0">Select Model</option>
                </select>
            </div>

            <div class="row">
                <select id="category" name="categoryId">
                    <option value="0">Select Category</option>
                </select>

                <select id="storage" name="storageId">
                    <option value="0">Select Storage</option>
                </select>
            </div>

            <div class="row">
                <select id="color" name="colorId">
                    <option value="0">Select Color</option>
                </select>

                <select id="quality" name="conditionId">
                    <option value="0">Select Quality</option>
                </select>

            </div>

            <input type="text" name="title" placeholder="Product Title">
            <textarea name="description" placeholder="Product Description"></textarea>

            <div class="row">
                <input type="number" name="price" placeholder="Price">
                <input type="number" name="qty" placeholder="Quantity">
            </div>

            <div class="row">
                <input type="file" name="image1">
                <input type="file" name="image2">
                <input type="file" name="image3">
            </div>

            <button type="button" onclick="saveProduct()">Save Product</button>

        </form>


    </main>

    &lt;!&ndash; Add Records Section (hidden by default) &ndash;&gt;
    <div id="addRecordsPanel" style="display:none; margin-top:50px;">

        <h1>Add Table Records</h1>

        &lt;!&ndash; Brand &ndash;&gt;
        <div class="product-form">
            <h2>Add Brand</h2>
            <form id="brandForm">
                <input type="text" name="name" placeholder="Brand Name" required>
                <button type="submit">Save Brand</button>
            </form>
        </div>

        &lt;!&ndash; Model &ndash;&gt;
        <div class="product-form">
            <h2>Add Model</h2>
            <form id="modelForm">
                <input type="text" name="name" placeholder="Model Name" required>
                <input type="number" name="brandId" placeholder="Brand ID" required>
                <button type="submit">Save Model</button>
            </form>
        </div>

        &lt;!&ndash; Color &ndash;&gt;
        <div class="product-form">
            <h2>Add Color</h2>
            <form id="colorForm">
                <input type="text" name="value" placeholder="Color Value" required>
                <button type="submit">Save Color</button>
            </form>
        </div>

        &lt;!&ndash; Storage &ndash;&gt;
        <div class="product-form">
            <h2>Add Storage</h2>
            <form id="storageForm">
                <input type="text" name="value" placeholder="Storage Value" required>
                <button type="submit">Save Storage</button>
            </form>
        </div>

        &lt;!&ndash; Quality &ndash;&gt;
        <div class="product-form">
            <h2>Add Quality</h2>
            <form id="qualityForm">
                <input type="text" name="value" placeholder="Quality Value" required>
                <button type="submit">Save Quality</button>
            </form>
        </div>

        &lt;!&ndash; Status &ndash;&gt;
        <div class="product-form">
            <h2>Add Status</h2>
            <form id="statusForm">
                <input type="text" name="value" placeholder="Status Value" required>
                <button type="submit">Save Status</button>
            </form>
        </div>

        &lt;!&ndash; Category &ndash;&gt;
        <div class="product-form">
            <h2>Add Category</h2>
            <form id="categoryForm">
                <input type="text" name="name" placeholder="Category Name" required>
                <button type="submit">Save Category</button>
            </form>
        </div>

    </div>

</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {

        loadSelect("GetAllModel", "model", "id", "name");
        loadSelect("GetAllCategory", "category", "id", "name");
        loadSelect("GetAllStorage", "storage", "id", "value");
        loadSelect("GetAllColor", "color", "id", "value");
        loadSelect("GetAllStatus", "condition", "id", "value");
        loadSelect("GetAllQuality", "quality", "id", "value");
    });

    function loadSelect(url, selectId, valueKey, textKey) {
        const select = document.getElementById(selectId);
        if (!select) {
            console.warn("Select element not found:", selectId);
            return;
        }

        fetch(url)
            .then(res => res.json())
            .then(data => {
                data.forEach(item => {
                    const option = document.createElement("option");
                    option.value = item[valueKey];
                    option.textContent = item[textKey];
                    select.appendChild(option);
                });
            })
            .catch(err => console.error("Error loading", selectId, err));
    }

</script>

<script>
    function saveProduct() {
        const form = document.getElementById("productForm");
        const formData = new FormData(form);

        fetch("SaveProduct", {
            method: "POST",
            body: formData
        })
            .then(res => res.json())
            .then(data => {
                alert(data.message);

                if (data.status) {
                    form.reset();
                }
            })
            .catch(err => {
                console.error(err);
                alert("Something went wrong!");
            });
    }
</script>


&lt;!&ndash;record js&ndash;&gt;
<script>
    // Get sidebar links
    const sidebarLinks = document.querySelectorAll(".sidebar li");
    const addRecordsPanel = document.getElementById("addRecordsPanel");
    const productForm = document.getElementById("productForm");

    // Helper to reset all forms inside a container
    function resetForms(container) {
        const forms = container.querySelectorAll("form");
        forms.forEach(f => f.reset());
    }

    // Sidebar navigation click handler
    sidebarLinks.forEach(link => {
        link.addEventListener("click", () => {
            // Highlight active link
            sidebarLinks.forEach(l => l.classList.remove("active"));
            link.classList.add("active");

            const linkText = link.textContent.trim();
            if(linkText === "Add Product") {
                productForm.style.display = "block";
                addRecordsPanel.style.display = "none";
                resetForms(addRecordsPanel); // clear Add Records forms
            } else if(linkText === "Add Records") {
                productForm.style.display = "none";
                addRecordsPanel.style.display = "block";
                resetForms(productForm); // clear Product form
            } else {
                // For other links, hide both forms if needed
                productForm.style.display = "none";
                addRecordsPanel.style.display = "none";
            }
        });
    });
</script>


</body>
</html>
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin | Add Product</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background: #f4f6f9;
        }

        .admin-layout {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 220px;
            background: #1e1e2f;
            color: white;
            padding: 20px;
        }

        .sidebar h2 {
            text-align: center;
            margin-bottom: 30px;
        }

        .sidebar ul {
            list-style: none;
        }

        .sidebar li {
            padding: 12px;
            cursor: pointer;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .sidebar li:hover,
        .sidebar .active {
            background: #3a3af0;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .main-content h1 {
            margin-bottom: 20px;
            font-size: 24px;
            color: #333;
        }

        /* Forms */
        .product-form {
            background: white;
            padding: 25px;
            border-radius: 8px;
            max-width: 900px;
            margin-bottom: 30px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .product-form h2 {
            margin-bottom: 15px;
            font-size: 20px;
            color: #3a3af0;
        }

        .product-form input,
        .product-form select,
        .product-form textarea,
        .product-form button {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        .product-form textarea {
            resize: none;
            height: 90px;
        }

        .row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .product-form button {
            background: #3a3af0;
            color: white;
            border: none;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .product-form button:hover {
            background: #2c2cd8;
        }

        /* Add Records Section */
        #addRecordsPanel {
            display: none;
        }

        .record-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .record-row .product-form {
            flex: 1 1 300px;
        }

        /* Responsive */
        @media(max-width: 768px){
            .row {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
<div class="admin-layout">

    <!-- Sidebar -->
    <aside class="sidebar">
        <h2>ADMIN</h2>
        <ul>
            <li class="active">Add Product</li>
            <li>Add Records</li>
            <li>Users</li>
            <li>Orders</li>
        </ul>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

        <!-- Add Product Form -->
        <div id="productPanel">
            <h1>Add New Product</h1>
            <form id="productForm" class="product-form" enctype="multipart/form-data">
                <div class="row">
                    <select id="model" name="modelId">
                        <option value="0">Select Model</option>
                    </select>
                </div>
                <div class="row">
                    <select id="category" name="categoryId">
                        <option value="0">Select Category</option>
                    </select>
                    <select id="storage" name="storageId">
                        <option value="0">Select Storage</option>
                    </select>
                </div>
                <div class="row">
                    <select id="color" name="colorId">
                        <option value="0">Select Color</option>
                    </select>
                    <select id="quality" name="conditionId">
                        <option value="0">Select Quality</option>
                    </select>
                </div>
                <input type="text" name="title" placeholder="Product Title">
                <textarea name="description" placeholder="Product Description"></textarea>
                <div class="row">
                    <input type="number" name="price" placeholder="Price">
                    <input type="number" name="qty" placeholder="Quantity">
                </div>
                <div class="row">
                    <input type="file" name="image1">
                    <input type="file" name="image2">
                    <input type="file" name="image3">
                </div>
                <button type="button" onclick="saveProduct()">Save Product</button>
            </form>
        </div>

        <!-- Add Records Panel -->
        <div id="addRecordsPanel">
            <h1>Add Table Records</h1>
            <div class="record-row">
                <!-- Brand Form -->
                <div class="product-form">
                    <h2>Add Brand</h2>
                    <form id="brandForm">
                        <input type="text" name="name" placeholder="Brand Name" required>
                        <button type="submit">Save Brand</button>
                    </form>
                </div>

                <!-- Model Form -->
                <div class="product-form">
                    <h2>Add Model</h2>
                    <form id="modelForm">
                        <input type="text" name="name" placeholder="Model Name" required>
                        <input type="number" name="brandId" placeholder="Brand ID" required>
                        <button type="submit">Save Model</button>
                    </form>
                </div>

                <!-- Color Form -->
                <div class="product-form">
                    <h2>Add Color</h2>
                    <form id="colorForm">
                        <input type="text" name="value" placeholder="Color Value" required>
                        <button type="submit">Save Color</button>
                    </form>
                </div>

                <!-- Storage Form -->
                <div class="product-form">
                    <h2>Add Storage</h2>
                    <form id="storageForm">
                        <input type="text" name="value" placeholder="Storage Value" required>
                        <button type="submit">Save Storage</button>
                    </form>
                </div>

                <!-- Quality Form -->
                <div class="product-form">
                    <h2>Add Quality</h2>
                    <form id="qualityForm">
                        <input type="text" name="value" placeholder="Quality Value" required>
                        <button type="submit">Save Quality</button>
                    </form>
                </div>

                <!-- Status Form -->
                <div class="product-form">
                    <h2>Add Status</h2>
                    <form id="statusForm">
                        <input type="text" name="value" placeholder="Status Value" required>
                        <button type="submit">Save Status</button>
                    </form>
                </div>

                <!-- Category Form -->
                <div class="product-form">
                    <h2>Add Category</h2>
                    <form id="categoryForm">
                        <input type="text" name="name" placeholder="Category Name" required>
                        <button type="submit">Save Category</button>
                    </form>
                </div>

            </div>
        </div>

    </main>
</div>

<script>
    // Sidebar navigation
    const sidebarLinks = document.querySelectorAll(".sidebar li");
    const addRecordsPanel = document.getElementById("addRecordsPanel");
    const productPanel = document.getElementById("productPanel");

    function resetForms(container){
        container.querySelectorAll("form").forEach(f => f.reset());
    }

    sidebarLinks.forEach(link => {
        link.addEventListener("click", () => {
            sidebarLinks.forEach(l => l.classList.remove("active"));
            link.classList.add("active");

            if(link.textContent.trim() === "Add Product"){
                productPanel.style.display = "block";
                addRecordsPanel.style.display = "none";
                resetForms(addRecordsPanel);
            } else if(link.textContent.trim() === "Add Records"){
                productPanel.style.display = "none";
                addRecordsPanel.style.display = "block";
                resetForms(productPanel);
            } else {
                productPanel.style.display = "none";
                addRecordsPanel.style.display = "none";
            }
        });
    });

    // Fetch select options
    document.addEventListener("DOMContentLoaded", () => {
        function loadSelect(url, selectId, valueKey, textKey) {
            const select = document.getElementById(selectId);
            if(!select) return;
            fetch(url).then(res => res.json())
                .then(data => data.forEach(item => {
                    const option = document.createElement("option");
                    option.value = item[valueKey];
                    option.textContent = item[textKey];
                    select.appendChild(option);
                })).catch(err => console.error(err));
        }

        loadSelect("GetAllModel", "model", "id", "name");
        loadSelect("GetAllCategory", "category", "id", "name");
        loadSelect("GetAllStorage", "storage", "id", "value");
        loadSelect("GetAllColor", "color", "id", "value");
        loadSelect("GetAllStatus", "condition", "id", "value");
        loadSelect("GetAllQuality", "quality", "id", "value");
    });

    // Save Product
    function saveProduct(){
        const form = document.getElementById("productForm");
        const formData = new FormData(form);
        fetch("SaveProduct", { method: "POST", body: formData })
            .then(res => res.json())
            .then(data => {
                alert(data.message);
                if(data.status) form.reset();
            }).catch(err => {
            console.error(err);
            alert("Something went wrong!");
        });
    }

    // Save Records forms
    function saveForm(formId, servletUrl){
        const form = document.getElementById(formId);
        form.addEventListener("submit", function(e){
            e.preventDefault();
            const formData = new FormData(this);
            fetch(servletUrl, { method:"POST", body: formData })
                .then(res=>res.json())
                .then(data=>{
                    alert(data.message);
                    if(data.status) form.reset();
                })
                .catch(err=>{
                    console.error(err);
                    alert("Error saving record!");
                });
        });
    }

    saveForm("brandForm","SaveBrand");
    saveForm("modelForm","SaveModel");
    saveForm("colorForm","SaveColor");
    saveForm("storageForm","SaveStorage");
    saveForm("qualityForm","SaveQuality");
    saveForm("statusForm","SaveStatus");
    saveForm("categoryForm","SaveCategory");
</script>

<script>
    document.addEventListener("DOMContentLoaded", () => {

        // Form configurations
        const forms = [
            { id: "brandForm", url: "SaveBrand" },
            { id: "modelForm", url: "SaveModel" },
            { id: "colorForm", url: "SaveColor" },
            { id: "storageForm", url: "SaveStorage" },
            { id: "qualityForm", url: "SaveQuality" },
            { id: "statusForm", url: "SaveStatus" },
            { id: "categoryForm", url: "SaveCategory" }
        ];

        // Setup AJAX for each form
        forms.forEach(f => setupAjaxForm(f.id, f.url));

        function setupAjaxForm(formId, servletName) {
            const form = document.getElementById(formId);
            if (!form) {
                console.warn(`Form with id "${formId}" not found`);
                return;
            }

            form.addEventListener("submit", e => {
                e.preventDefault();

                console.clear();
                console.log("===== SUBMIT FORM:", formId, "=====");

                // Validation
                let valid = true;

                for (let input of form.querySelectorAll("input[required]")) {
                    console.log("Validating INPUT:", input.name, "=", input.value);

                    if (input.value.trim() === "") {
                        const fieldName = input.placeholder || input.name;
                        alert(fieldName + " cannot be empty");
                        input.focus();
                        valid = false;
                        break;
                    }

                    if (input.type === "number" && (isNaN(input.value) || input.value.trim() === "")) {
                        alert(input.placeholder + " must be a valid number");
                        input.focus();
                        valid = false;
                        break;
                    }
                }

                if (!valid) return;

                // ✅ KEY FIX: Build URLSearchParams instead of FormData for proper servlet compatibility
                const formData = new URLSearchParams();

                for (let input of form.querySelectorAll("input")) {
                    if (input.name && input.value) {
                        formData.append(input.name, input.value.trim());
                        console.log("Adding to formData:", input.name, "=", input.value.trim());
                    }
                }

                console.log("---- Form Data Being Sent ----");
                console.log(formData.toString());

                const fullUrl = servletName;
                console.log("POST URL:", fullUrl);

                // Disable submit button
                const submitBtn = form.querySelector('button[type="submit"]');
                const originalText = submitBtn ? submitBtn.textContent : "";
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.textContent = "Saving...";
                }

                // ✅ KEY FIX: Send as application/x-www-form-urlencoded
                fetch(fullUrl, {
                    method: "POST",
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: formData.toString()
                })
                    .then(res => {
                        console.log("HTTP STATUS:", res.status);

                        const contentType = res.headers.get("content-type");
                        if (contentType && contentType.includes("application/json")) {
                            return res.json();
                        } else {
                            return res.text().then(text => {
                                console.error("Non-JSON response:", text);
                                throw new Error("Server did not return JSON. Response: " + text);
                            });
                        }
                    })
                    .then(data => {
                        console.log("RESPONSE JSON:", data);

                        if (data.status === true) {
                            alert(data.message || "Saved successfully!");
                            form.reset();
                        } else {
                            alert(data.message || "Failed to save record!");
                        }
                    })
                    .catch(err => {
                        console.error("AJAX ERROR:", err);
                        alert("Server error occurred! Check console for details.\n" + err.message);
                    })
                    .finally(() => {
                        if (submitBtn) {
                            submitBtn.disabled = false;
                            submitBtn.textContent = originalText;
                        }
                    });
            });
        }

        // Sidebar toggle functionality
        const sidebarLinks = document.querySelectorAll(".sidebar li");
        const productPanel = document.getElementById("productPanel");
        const addRecordsPanel = document.getElementById("addRecordsPanel");

        function resetForms(container) {
            if (!container) return;
            container.querySelectorAll("form").forEach(f => f.reset());
        }

        sidebarLinks.forEach(link => {
            link.addEventListener("click", () => {
                sidebarLinks.forEach(l => l.classList.remove("active"));
                link.classList.add("active");

                const text = link.textContent.trim();

                if (text === "Add Product") {
                    if (productPanel) productPanel.style.display = "block";
                    if (addRecordsPanel) addRecordsPanel.style.display = "none";
                    resetForms(addRecordsPanel);
                } else if (text === "Add Records") {
                    if (productPanel) productPanel.style.display = "none";
                    if (addRecordsPanel) addRecordsPanel.style.display = "block";
                    resetForms(productPanel);
                } else {
                    if (productPanel) productPanel.style.display = "none";
                    if (addRecordsPanel) addRecordsPanel.style.display = "none";
                }
            });
        });

    });
</script>





</body>
</html>
